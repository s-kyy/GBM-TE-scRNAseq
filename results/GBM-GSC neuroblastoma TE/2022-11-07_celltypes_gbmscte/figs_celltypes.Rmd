---
title: "Cell Type Analysis"
output:
  html_document:
    toc: yes
editor_options:
  chunk_output_type: inline
---

**Goal**: Identify and label cell types for each cluster in GBMSCTE Seurat objects. 

## Load Libraries

```{r}
library(ggplot2)
library(SeuratObject)
library(Seurat)

library(dplyr)

library(conflicted)
conflict_prefer("select", "dplyr") ## required in %>% dplyr

set.seed(100)

print(getwd())
```

## PLot Known Cell Type Markers:GTE

### Load Data

```{r}
gte <- readRDS("D:\\backup files\\2021-11-11\\Cluster\\scratch\\gete-gbm\\results\\GBM-GSC neuroblastoma TE\\2021-09-02\\gte_gbmscIntUmap-subtypes.rds")
# ge <- readRDS("D:\\backup files\\2021-11-11\\Cluster\\scratch\\gete-gbm\\results\\GBM-GSC neuroblastoma TE\\2021-09-02\\gte_gbmscIntUmap-subtypes.rds")
```

```{r}
# DefaultAssay(gte) <- "integrated"
# DefaultAssay(ge) <- "integrated"
# DefaultAssay(gte) <- "RNA"
# DefaultAssay(ge) <- "RNA"
size = 5

colnames(gte@meta.data)
setwd("D:\\backup files\\getegbm\\gete-gbm\\results\\GBM-GSC neuroblastoma TE\\2022-11-07_celltypes_gbmscte")
  #run this line outside of a chunk
```


### UMAPs of Known Markers
Known Cell types markers from Velmeshev2019, Zhong 2018, Nowakowski2017, and discussions with Dr. Tanaka (Aug 2021)

```{r}
## Neural Progenitor Cells (NPCs) Early Development Markers
print(match(c("PAX6", "SOX2"), rownames(gte)))
p <- FeaturePlot(gte, features = c("PAX6", "SOX2"))
# ggsave("fig_gbmscte_gte_NPC-early.tiff", plot = p, units="in", width=size*2, height=size, dpi=300, compression = 'lzw')
```

```{r}
## NPCs Late Marker Genes
print(match(c("SFRP1", "RBFOX1", "HES1", "SOX2", "EMX2"), rownames(gte))) 
  #RBFOX1,2,3 all absent
print(match(c("SFRP1", "HRNBP1", "HES1", "SOX2", "EMX2"), rownames(gte))) 
  # A2BP1, FOX-1 HRNBP1 all absent

p <- FeaturePlot(gte, features = c("SFRP1", "HES1", "SOX2", "EMX2"))
# ggsave("fig_gbmscte_gte_NPC-late_RNA.tiff", plot = p, units="in", width=size*2, height=size*2, dpi=300, compression = 'lzw')
```

```{r}
## Excitatory Neurons Early Markers
print(match(c("NEUROD2"), rownames(gte)))
p <- FeaturePlot(gte, features = c("NEUROD2"))
# ggsave("fig_gbmscte_gte_ExcN-early_RNA.tiff", plot = p, units="in", width=size, height=size, dpi=300, compression = 'lzw')
```

```{r}
## Excitatory Neurons Late Markers
print(match(c("NEUROD1", "NEUROD6", "SFRP1", "SLA", "NEUROD2", "HES1"), rownames(gte)))
p <- FeaturePlot(gte, features = c("NEUROD1", "NEUROD6", "SFRP1", "SLA", "NEUROD2", "HES1"))
# ggsave("fig_gbmscte_gte_ExcN-late_RNA.tiff", plot = p, units="in", width=size*2, height=size*3, dpi=300, compression = 'lzw')
```

```{r}
## Interneurons Early Markers
print(match(c("TTF1", "LHX6", "DLX1", "DLX2", "CALB2", "SST"), rownames(gte)))
p <- FeaturePlot(gte, features = c("TTF1", "LHX6", "DLX1", "DLX2", "CALB2", "SST"))
# ggsave("fig_gbmscte_gte_InterN-early.tiff", plot = p, units="in", width=size*2, height=size*3, dpi=300, compression = 'lzw')
```

```{r}
## Interneurons Late Markers
print(match(c("GAD1", "GAD2", "PDE4DIP", "LHX6", "DLX1", "CALB2", "CCK", "VIP", "PVALB"), rownames(gte)))
p <- FeaturePlot(gte, features = c("GAD1", "GAD2", "PDE4DIP", "LHX6", "DLX1", "CALB2", "CCK", "VIP", "PVALB"))
# ggsave("fig_gbmscte_gte_InterN-late.tiff", plot = p, units="in", width=size*2, height=size*2, dpi=300, compression = 'lzw')
```


```{r}
## OPC Markers
print(match(c("OLIG1", "OLIG2", "SOX10", "SOX2", "YY1", "ZNF24", "ASCL1", "PDGFRA", "HES5", "COL20A1", "PMP2"), rownames(gte)))
p <- FeaturePlot(gte, features = c("OLIG1", "OLIG2", "SOX10", "SOX2", "YY1", "ZNF24", "ASCL1", "PDGFRA", "HES5", "COL20A1", "PMP2"))
# ggsave("fig_gbmscte_gte_OPC_RNA.tiff", plot = p, units="in", width=size*4, height=size*3, dpi=300, compression = 'lzw')
```

```{r}
## Oligodendrocytes
print(match(c("MYRF", "MBP", "MOG", "PLP1"), rownames(gte)))
p <- FeaturePlot(gte, features = c("MYRF", "MBP", "MOG", "PLP1"))
# ggsave("fig_gbmscte_gte_OLIG_RNA.tiff", plot = p, units="in", width=size*2, height=size*2, dpi=300, compression = 'lzw')
```

```{r}
## Astrocytes
print(match(c("GFAP", "AQP4", "SLCO1C1", "SLC1A2"), rownames(gte)))
p <- FeaturePlot(gte, features = c("GFAP", "AQP4", "SLCO1C1", "SLC1A2"))
# ggsave("fig_gbmscte_gte_Ast_RNA.tiff", plot = p, units="in", width=size*2, height=size*2, dpi=300, compression = 'lzw')
```

```{r}
## Microglia early + late development
print(match(c("P2RY12", "PTPRC", "C1QB", "CD68", "TREM2", "GPR34", "CSF1R", "CXCR1"), rownames(gte)))
p <- FeaturePlot(gte, features = c("P2RY12", "PTPRC", "C1QB", "CD68", "TREM2", "GPR34", "CSF1R", "CXCR1"))
# ggsave("fig_gbmscte_gte_MGlia_earlylate_RNA.tiff", plot = p, units="in", width=size*2, height=size*2, dpi=300, compression = 'lzw')
```

```{r}
## Outer Radial Glia- early-late
print(match(c("HOPX", "FAM107A", "TNC", "PAX6", "VIM", "ZIC2", "SLC7A11", "MTOR", "DAB1","LAMP5", "IL13RA2"), rownames(gte)))
p <- FeaturePlot(gte, features = c("HOPX", "FAM107A", "TNC", "PAX6", "VIM", "ZIC2", "SLC7A11", "MTOR", "DAB1","LAMP5", "IL13RA2"))
# ggsave("fig_gbmscte_gte_oRG_RNA.tiff", plot = p, units="in", width=size*4, height=size*3, dpi=300, compression = 'lzw')
```

```{r}
## Ventral Radial glia Progenitor cells
print(match(c("DLX1", "DLX2", "FLRT2", "LIX1"), rownames(gte)))
p <- FeaturePlot(gte, features = c("DLX1", "DLX2", "FLRT2", "LIX1"))
# ggsave("fig_gbmscte_gte_vRGprogenitor_RNA.tiff", plot = p, units="in", width=size*2, height=size*2, dpi=300, compression = 'lzw')
```


```{r}
## Cortical ventral radial glia
print(match(c("PAX6", "VIM", "ZIC2", "HOPX"), rownames(gte)))
p <- FeaturePlot(gte, features = c("PAX6", "VIM", "ZIC2", "HOPX"))
# ggsave("fig_gbmscte_gte_vRG_RNA.tiff", plot = p, units="in", width=size*2, height=size*2, dpi=300, compression = 'lzw')

```

```{r}
## IPC (Intermediate precursor cells) - early
print(match(c("NHLH1", "SLC1A3"), rownames(gte)))
p <- FeaturePlot(gte, features = c("NHLH1", "SLC1A3"))
# ggsave("fig_gbmscte_gte_IPC_early_RNA.tiff", plot = p, units="in", width=size*2, height=size, dpi=300, compression = 'lzw')
```

```{r}
## IPC (Intermediate precursor cells) - late
print(match(c("ASCL1", "NHLH2", "TP53I11", "PPP1R17", "ADRA2A", "LTBP1"), rownames(gte)))
p <- FeaturePlot(gte, features = c("ASCL1", "NHLH2", "TP53I11", "PPP1R17", "ADRA2A", "LTBP1"))
# ggsave("fig_gbmscte_gte_IPC_late_RNA.tiff", plot = p, units="in", width=size*2, height=size, dpi=300, compression = 'lzw')
```

```{r}
## Ventral IPC (Intermediate precursor cells)
print(match(c("FLRT2", "DLX1", "DLX2", "DLX5", "DLX6"), rownames(gte)))
p <- FeaturePlot(gte, features = c("FLRT2", "DLX1", "DLX2", "DLX5", "DLX6"))
# ggsave("fig_gbmscte_gte_ventralIPC_RNA.tiff", plot = p, units="in", width=size*2, height=size*3, dpi=300, compression = 'lzw')
```

```{r}
## dorsal IPC (Intermediate precursor cells)
print(match(c("PAX6", "ZIC2", "EOMES", "ASCL1", "SSTR2"), rownames(gte)))
p <- FeaturePlot(gte, features = c("PAX6", "ZIC2", "EOMES", "ASCL1", "SSTR2"))
# ggsave("fig_gbmscte_gte_dorsalIPC_RNA.tiff", plot = p, units="in", width=size*2, height=size*3, dpi=300, compression = 'lzw')
```

```{r}
## Endothelial Cells 
print(match(c("FLT1", "VWF", "FN1"), rownames(gte)))
p <- FeaturePlot(gte, features = c("FLT1", "VWF", "FN1"))
# ggsave("fig_gbmscte_gte_Endothelial_RNA.tiff", plot = p, units="in", width=size*2, height=size*2, dpi=300, compression = 'lzw')
```

```{r}
## T-cells 
print(match(c("CD3E", "CD8A"), rownames(gte)))
p <- FeaturePlot(gte, features = c("CD3E", "CD8A"))
# ggsave("fig_gbmscte_gte_Tcells_RNA.tiff", plot = p, units="in", width=size*2, height=size, dpi=300, compression = 'lzw')
```

```{r}
## Blood Cells 
print(match(c("HBB"), rownames(gte)))
p <- FeaturePlot(gte, features = c("HBB"))
# ggsave("fig_gbmscte_gte_Blood_RNA.tiff", plot = p, units="in", width=size, height=size, dpi=300, compression = 'lzw')
```

2022-11-11: Test Nowakowski 2017 oRG marker genes + Pollen2015 oRG marker Genes

```{r}
## Outer Radial Glia- Nowakowski.2017
print(match(c("MTOR", "RPS6", "DAB1", "LAMP5", "IL13RA2", "GLI2", "GFAP"), rownames(gte)))
p <- FeaturePlot(gte, features = c("MTOR", "RPS6", "DAB1", "LAMP5", "IL13RA2", "GLI2", "GFAP"))
# ggsave("fig_gbmscte_gte_oRG_RNA_Nowakowski2017.tiff", plot = p, units="in", width=size*3, height=size*3, dpi=300, compression = 'lzw')
```

```{r}
## ventricular Radial Glia- Nowakowski.2017
print(match(c("NEUROG2", "NEUROD6", "NEUROD1", "HMGA2", "NFATC2", "STMN2", "ELAVL4"), rownames(gte)))
p <- FeaturePlot(gte, features = c("NEUROG2", "NEUROD6", "NEUROD1", "HMGA2", "NFATC2", "STMN2", "ELAVL4"))
# ggsave("fig_gbmscte_gte_vRG_RNA_Nowakowski2017.tiff", plot = p, units="in", width=size*3, height=size*3, dpi=300, compression = 'lzw')
```

```{r}
##Radial Glia- Nowakowski.2017
print(match(c("EMX1", "NKX2-1"), rownames(gte)))
p <- FeaturePlot(gte, features = c("EMX1", "NKX2-1"))
# ggsave("fig_gbmscte_gte_RG_RNA_Nowakowski2017.tiff", plot = p, units="in", width=size*2, height=size, dpi=300, compression = 'lzw')
```

```{r}
## Radial Glia- Pollen.2015
print(match(c("SLC1A3", "PAX6", "SOX2", "PDGFD", "GLI3", "VIM", "HES1"), rownames(gte)))
p <- FeaturePlot(gte, features = c("SLC1A3", "PAX6", "SOX2", "PDGFD", "GLI3", "VIM", "HES1"))
# ggsave("fig_gbmscte_gte_RG_RNA_Pollen2015.tiff", plot = p, units="in", width=size*3, height=size*3, dpi=300, compression = 'lzw')
```

In Pollen.2015, it was noted to be a novel G1 marker. 

```{r}
p <- FeaturePlot(gte, features = "CRYAB") 
# ggsave("fig_gbmscte_gte_CRYAB_RNA_Pollen2015.tiff", plot = p, units="in", width=size, height=size, dpi=300, compression = 'lzw')
```

```{r}
## oRG (MOXD1), vRG (FBXO32) Pollen 2015
print(match(c("MOXD1", "FBXO32"), rownames(gte)))
p <- FeaturePlot(gte, features = c("MOXD1", "FBXO32")) 
# ggsave("fig_gbmscte_gte_oRGvRG_RNA_Pollen2015.tiff", plot = p, units="in", width=size*2, height=size, dpi=300, compression = 'lzw')
```

EOMES was not detected in IPC's normalized values. 

```{r}
## IPC Markers (Close2017)
print(match(c("EOMES", "PAX6", "HOPX", "VIM"), rownames(gte)))
p <- FeaturePlot(gte, features = c("EOMES", "PAX6", "HOPX", "VIM"))
# ggsave("fig_gbmscte_gte_IPC-Close2017.tiff", plot = p, units="in", width=size*2, height=size*2, dpi=300, compression = 'lzw')
```

Normalized values show that none of the genes expressed here are significantly expressed. 

```{r}
## Interneurons (Close2017)
print(match(c("PVALB", "VIP", "HTR3A", "SST", "NPY", "CALB2", "CCK", "RELN", "NOS1"), rownames(gte)))
p <- FeaturePlot(gte, features = c("PVALB", "VIP", "HTR3A", "SST", "NPY", "CALB2", "CCK", "RELN", "NOS1"))
# ggsave("fig_gbmscte_gte_Interneurons-Close2017.tiff", plot = p, units="in", width=size*3, height=size*3, dpi=300, compression = 'lzw')
```

### Plots Summarizing Cell types


```{r}
DefaultAssay(gte) <- "RNA"
features = c(#"HBB", #Blood
              "CD3E", #T-cells
             "FLT1", "VWF", "FN1", #Endothelial
             "ASCL1", # IPC-late (?)
             "HOPX", "FAM107A", "TNC", "VIM", #orG
              "P2RY12", "PTPRC", "C1QC", "CD68", "TREM2", "GPR34", "CSF1R", #Microglia
              "GFAP", "AQP4", "SLC1A2", #Astrocytes
              "MYRF", "MBP", "MOG", "PLP1", #Oligodendrocytes
              "OLIG1", "OLIG2", "PDGFRA", "COL20A1", "SOX10",  #OPC
              "GAD1" #Interneurons
            # "HES1" #NPC
             )

p <- DotPlot(gte, features = features) +
      xlab("Known Brain Cell Markers") + ylab("Clusters") + coord_flip()
p
# ggsave("fig_gbmscte_gte_dotplot_summary_rna.tiff", plot = p, units="in", width=size*1.1, height=size*1.1, dpi=300, compression = 'lzw')
```

I should be looking at the average normalized RNA expression across clusters instead of the raw RNA count, because the RNA would have batch effects. 

```{r}
DefaultAssay(gte) <- "integrated"
features <- c(#"HBB", #Blood
              "CD3E", #"CD8A", #T-cells
              "FLT1", "VWF", "FN1", #Endothelial
              #"ASCL1", # IPC-late (?)
              #"PVALB", "SST", "GAD1", # Differentiated Cortical Interneurons (Inhibitory neurons)
              "MKI67", "MCM6", "TOP2A", "PCNA",  #Proliferating Cell Type
              "PTPRC", "C1QC", "CD68", "TREM2", "GPR34", "CSF1R", "CX3CR1", #Microglia, 
                #"P2RY12", "HEXB" were absent
              "GFAP", "AQP4", "HOPX", "SLC1A2", #Astrocytes
              "MYRF", "MBP", "MOG", "PLP1", #Oligodendrocytes
              "OLIG1", "OLIG2", "PDGFRA", "SOX10"  #OPC, "COL20A1" was absent
              #"HES1" #NPC
             )

p <- DotPlot(gte, features = features) +   scale_colour_gradient2() + 
      xlab("Known Brain Cell Markers") + ylab("Clusters") + coord_flip()
p
# ggsave("fig_gbmscte_gte_dotplot_summary_int.tiff", plot = p, units="in", width=size*1.1, height=size*1.2, dpi=300, compression = 'lzw')
```
Use the same marker genes on other PCA resolutions. 

```{r}
#Dotplot for PC20r0.4
DefaultAssay(gte) <- "integrated"
print(head(gte@active.ident))
gte <- SetIdent(gte, value = gte@meta.data$integrated_snn_res.0.4) 
print(head(gte@active.ident))
features <- c(#"HBB", #Blood
              "CD3E", #"CD8A", #T-cells
              "FLT1", "VWF", "FN1", #Endothelial
              #"ASCL1", # IPC-late (?)
              #"PVALB", "SST", "GAD1", # Differentiated Cortical Interneurons (Inhibitory neurons)
              "MKI67", "MCM6", "TOP2A", "PCNA",  #Proliferating Cell Type
              "PTPRC", "C1QC", "CD68", "TREM2", "GPR34", "CSF1R", "CX3CR1", #Microglia, 
                #"P2RY12", "HEXB" were absent
              "GFAP", "AQP4", "HOPX", "SLC1A2", #Astrocytes
              "MYRF", "MBP", "MOG", "PLP1", #Oligodendrocytes
              "OLIG1", "OLIG2", "PDGFRA", "SOX10"  #OPC, "COL20A1" was absent
              #"HES1" #NPC
             )

p <- DotPlot(gte, features = features) +   scale_colour_gradient2() + 
      xlab("Known Brain Cell Markers") + ylab("Clusters") + coord_flip()
print(p)
# ggsave("fig_gbmscte_gte_PC20r04_dotplot_summary_int.tiff", plot = p, units="in", width=size*1.1, height=size*1.2, dpi=300, compression = 'lzw')

p <- UMAPPlot(gte)
print(p)
# ggsave("fig_gbmscte_gte_PC20r04_UMAP.tiff", plot = p, units="in", width=size*1.2, height=size*1, dpi=300, compression = 'lzw')
```


```{r}
# Dotplot for RG, oRG, and vRG
DefaultAssay(gte) <- "integrated"
features.RG <- c(#"VIM", "SOX2", "SLC1A3", "HES1", "PAX6", "GLI3", "PDGFD", #RG -- from Pollen2015, 
                 "GFAP", "VIM", "SOX2", "HES1", "PAX6", #RG (only those present in normalized assay)
                 "TNC", "PTPRZ1", "FAM107A", "HOPX", #oRG -- "LIFR", RPS6 not present, Pollen2015 & Nowakowski2017, respectively.
                 #"DAB1", #oRG + vRG not present Nowakowski2017
                 "CRYAB", "TAGLN2", "FBXO32", "LIX1" #vRG -- PDGFD, PALLD NFATC2 were absent (Pollen2015), and "STMN2", "ELAVL4" were targeting other cell types (oligodendrocyte cluster 8) (Nowakowski2017)
                 )
p <- DotPlot(gte, features = features.RG) +   scale_colour_gradient2() + 
      xlab("Known Brain Cell Markers") + ylab("Clusters") + coord_flip()
p
# ggsave("fig_gbmscte_gte_dotplot_RG_int.tiff", plot = p, units="in", width=size*1.1, height=size*0.7, dpi=300, compression = 'lzw')
```
```{r}
# Dotplot for RG, oRG, and vRG
DefaultAssay(gte) <- "integrated"
gte <- SetIdent(gte, value = gte@meta.data$integrated_snn_res.0.4)
features.RG <- c(#"VIM", "SOX2", "SLC1A3", "HES1", "PAX6", "GLI3", "PDGFD", #RG -- from Pollen2015, 
                 "GFAP", "VIM", "SOX2", "HES1", "PAX6", #RG (only those present in normalized assay)
                 "TNC", "PTPRZ1", "FAM107A", "HOPX", #oRG -- "LIFR", RPS6 not present, Pollen2015 & Nowakowski2017, respectively.
                 #"DAB1", #oRG + vRG not present Nowakowski2017
                 "CRYAB", "TAGLN2", "FBXO32", "LIX1" #vRG -- PDGFD, PALLD NFATC2 were absent (Pollen2015), and "STMN2", "ELAVL4" were targeting other cell types (oligodendrocyte cluster 8) (Nowakowski2017)
                 )
p <- DotPlot(gte, features = features.RG) +   scale_colour_gradient2() + 
      xlab("Known Brain Cell Markers") + ylab("Clusters") + coord_flip()
print(p)
# ggsave("fig_gbmscte_gte_PC20r04_dotplot_RG_int.tiff", plot = p, units="in", width=size*1.2, height=size*0.7, dpi=300, compression = 'lzw')
```


### UMAP summarizing Cell Types


- isRG: {0: no, 1: yes}
- isoRG: {0:no, 1: oRG}
- isvRG: {0: no, 1: vRG}

```{r}
#Create updated metadata
DefaultAssay(gte) <- "integrated"
meta <- gte@meta.data

gte_celltype <- c(
  '0' = "Astrocyte",
  '1' = "Intermediate",
  '2' = "OPC", 
  '3' = "T-cell",
  '4' = "Microglia",
  '5' = "Proliferating",
  '6' = "Diff. Oligodendrocytes",
  '7' = "Intermediate",
  '8' = "Proliferating",
  '9' = "Intermediate",
  '10' = "Endothelial"
)

gte_rg <- c(
  '0' = 1,
  '1' = 0,
  '2' = 0, 
  '3' = 0,
  '4' = 0,
  '5' = 0,
  '6' = 0,
  '7' = 0,
  '8' = 1,
  '9' = 0,
  '10' = 0
)

gte_org <- c(
  '0' = 1,
  '1' = 0,
  '2' = 0, 
  '3' = 0,
  '4' = 0,
  '5' = 0,
  '6' = 0,
  '7' = 0,
  '8' = 0,
  '9' = 1,
  '10' = 0
)

gte_vrg <- c(
  '0' = 1,
  '1' = 0,
  '2' = 0, 
  '3' = 0,
  '4' = 0,
  '5' = 0,
  '6' = 0,
  '7' = 0,
  '8' = 0,
  '9' = 0,
  '10' = 0
)

meta$int03_celltypes <- NA
meta$int03_isRG <- 0
meta$int03_isoRG <- 0
meta$int03_isvRG <- 0

for (i in 1:length(gte_rg)) {
    meta$int03_celltypes[
        which(as.character(meta$integrated_snn_res.0.3) == names(gte_celltype[i]))]  <- gte_celltype[i]
    meta$int03_isRG[
        which(as.character(meta$integrated_snn_res.0.3) == names(gte_rg[i]))]  <- gte_rg[i]
    meta$int03_isoRG[
        which(as.character(meta$integrated_snn_res.0.3) == names(gte_org[i]))]  <- gte_org[i]
    meta$int03_isvRG[
        which(as.character(meta$integrated_snn_res.0.3) == names(gte_vrg[i]))]  <- gte_vrg[i]
}
head(meta)

gte@meta.data <- meta
# saveRDS(gte, file="gte_celltypes.rds")
# write.csv(meta,"gbmscte_meta_celltypes.csv", row.names= TRUE)
```

Create UMAP

```{r}
cbPalette <- c("#E69F00", "#56B4E9", "#009E73", "#F0E442", 
               "#CC79A7", "#ff716e", "#999999", "#0072B2", 
               "#194c76", "#D55E00", "#4C4E52")
gte <- SetIdent(gte, value = gte@meta.data$int03_celltypes) 
p <- DimPlot(gte, label=FALSE, cols = cbPalette) 
p
# ggsave("fig_gbmscte_gte_PC20r03_UMAP_celltypes.tiff", plot = p, units="in", width=size*1.4, height=size*1, dpi=300, compression = 'lzw')
```

### Dot plot Summarizing known markers by cell type

```{r}
DefaultAssay(gte) <- "integrated"
meta$int03_celltypes <- factor(meta$int03_celltypes,
                                       levels = c(
                                         "Astrocyte",
                                         "OPC",
                                         "Diff. Oligodendrocytes",
                                         "Microglia",
                                         "Proliferating",
                                         "Endothelial",
                                         "T-cell",
                                         "Intermediate"
                                       ))
gte@meta.data <- meta
gte <- SetIdent(gte, value = gte@meta.data$int03_celltypes)
features <- c(#"HBB", #Blood
              "CD3E", #"CD8A", #T-cells
              "FLT1", "VWF", "FN1", #Endothelial
              #"ASCL1", # IPC-late (?)
              #"PVALB", "SST", "GAD1", # Differentiated Cortical Interneurons (Inhibitory neurons)
              "MKI67", "MCM6", "TOP2A", "PCNA",  #Proliferating Cell Type
              "PTPRC", "C1QC", "CD68", "TREM2", "GPR34", "CSF1R", "CX3CR1", #Microglia, 
                #"P2RY12", "HEXB" were absent
              "MYRF", "MBP", "MOG", "PLP1", #Oligodendrocytes
              "OLIG1", "OLIG2", "PDGFRA", "SOX10",  #OPC, "COL20A1" was absent
              "GFAP", "AQP4", "HOPX", "SLC1A2" #Astrocytes
              #"HES1" #NPC
             )

p <- DotPlot(gte, features = features) +   scale_colour_gradient2() + 
      xlab("Known Brain Cell Markers") + ylab("Cell Types") + coord_flip() + 
      theme(axis.text.x = element_text(angle = 40, vjust = 1, hjust=1))
p
# ggsave("fig_gbmscte_gte_dotplot_summary_int_celltypes.tiff", plot = p, units="in", width=size*1.1, height=size*1.3, dpi=300, compression = 'lzw')

```

### Unload data

```{r}
rm(gte)
gc()
```



## PLot Known Cell Type Markers:GE

### Load data

```{r}
ge <- readRDS("D:\\backup files\\2021-11-11\\Cluster\\scratch\\gete-gbm\\results\\GBM-GSC neuroblastoma TE\\2021-09-02\\ge_gbmscIntUmap-subtypes.rds")

# DefaultAssay(ge) <- "integrated"
Idents(ge) <- "integrated_snn_res.0.3"
DefaultAssay(ge) <- "RNA"
size = 5

colnames(ge@meta.data)

setwd("D:\\backup files\\getegbm\\gete-gbm\\results\\GBM-GSC neuroblastoma TE\\2022-11-09_celltypes_gbmsc")
  #run this line outside of a chunk
```

### UMAPs

Known Cell types markers from Velmeshev2019, Zhong 2018, Nowakowski2017, and discussions with Dr. Tanaka (Aug 2021)

```{r}
## Neural Progenitor Cells (NPCs) Early Development Markers
print(match(c("PAX6", "SOX2"), rownames(ge)))
p <- FeaturePlot(ge, features = c("PAX6", "SOX2"))
# ggsave("fig_gbmscte_ge_NPC-early.tiff", plot = p, units="in", width=size*2, height=size*2, dpi=300, compression = 'lzw')
```

```{r}
## NPCs Late Marker Genes
print(match(c("SFRP1", "RBFOX1", "HES1", "SOX2", "EMX2", "EOMES"), rownames(ge))) 
p <- FeaturePlot(ge, features = c("SFRP1", "RBFOX1", "HES1", "SOX2", "EMX2", "EOMES"))
# ggsave("fig_gbmscte_ge_NPC-late_RNA.tiff", plot = p, units="in", width=size*2, height=size*3, dpi=300, compression = 'lzw')
```

```{r}
## Excitatory Neurons Early Markers
print(match(c("NEUROD2"), rownames(ge)))
p <- FeaturePlot(ge, features = c("NEUROD2"))
# ggsave("fig_gbmscte_ge_ExcN-early_RNA.tiff", plot = p, units="in", width=size, height=size, dpi=300, compression = 'lzw')
```

```{r}
## Excitatory Neurons Late Markers
print(match(c("NEUROD1", "NEUROD6", "SFRP1", "SLA", "NEUROD2", "HES1"), rownames(ge)))
p <- FeaturePlot(ge, features = c("NEUROD1", "NEUROD6", "SFRP1", "SLA", "NEUROD2", "HES1"))
# ggsave("fig_gbmscte_ge_ExcN-late_RNA.tiff", plot = p, units="in", width=size*2, height=size*3, dpi=300, compression = 'lzw')
```

```{r}
## Interneurons Early Markers
print(match(c("TTF1", "LHX6", "DLX1", "DLX2", "CALB2", "SST"), rownames(ge)))
p <- FeaturePlot(ge, features = c("TTF1", "LHX6", "DLX1", "DLX2", "CALB2", "SST"))
# ggsave("fig_gbmscte_ge_InterN-early.tiff", plot = p, units="in", width=size*2, height=size*3, dpi=300, compression = 'lzw')
```

```{r}
## Interneurons Late Markers
print(match(c("GAD1", "GAD2", "PDE4DIP", "LHX6", "DLX1", "CALB2", "CCK", "VIP", "PVALB"), rownames(ge)))
p <- FeaturePlot(ge, features = c("GAD1", "GAD2", "PDE4DIP", "LHX6", "DLX1", "CALB2", "CCK", "VIP", "PVALB"))
# ggsave("fig_gbmscte_ge_InterN-late.tiff", plot = p, units="in", width=size*2, height=size*2, dpi=300, compression = 'lzw')
```

```{r}
## OPC Markers
print(match(c("OLIG1", "OLIG2", "SOX10", "SOX2", "YY1", "ZNF24", "ASCL1", "PDGFRA", "HES5", "COL20A1", "PMP2"), rownames(ge)))
p <- FeaturePlot(ge, features = c("OLIG1", "OLIG2", "SOX10", "SOX2", "YY1", "ZNF24", "ASCL1", "PDGFRA", "HES5", "COL20A1", "PMP2"))
# ggsave("fig_gbmscte_ge_OPC_RNA.tiff", plot = p, units="in", width=size*4, height=size*3, dpi=300, compression = 'lzw')
```

```{r}
## Oligodendrocytes
print(match(c("MYRF","MBP", "MOG", "PLP1"), rownames(ge)))
p <- FeaturePlot(ge, features = c("MYRF","MBP", "MOG", "PLP1"))
# ggsave("fig_gbmscte_ge_OLIG_RNA.tiff", plot = p, units="in", width=size*2, height=size*2, dpi=300, compression = 'lzw')
```

```{r}
## Astrocytes
print(match(c("GFAP", "AQP4", "SLCO1C1", "SLC1A2"), rownames(ge)))
p <- FeaturePlot(ge, features = c("GFAP", "AQP4", "SLCO1C1", "SLC1A2"))
# ggsave("fig_gbmscte_ge_Ast_RNA.tiff", plot = p, units="in", width=size*2, height=size*2, dpi=300, compression = 'lzw')
```

```{r}
## Microglia early + late development
print(match(c("P2RY12", "PTPRC", "C1QB", "CD68", "TREM2", "GPR34", "CSF1R", "CXCR1"), rownames(ge)))
p <- FeaturePlot(ge, features = c("P2RY12", "PTPRC", "C1QB", "CD68", "TREM2", "GPR34", "CSF1R", "CXCR1"))
# ggsave("fig_gbmscte_ge_MGlia_earlylate_RNA.tiff", plot = p, units="in", width=size*3, height=size*3, dpi=300, compression = 'lzw')
```

```{r}
## Outer Radial Glia- early-late
print(match(c("HOPX", "FAM107A", "TNC", "PAX6", "VIM", "ZIC2", "SLC7A11", "MTOR", "DAB1","LAMP5", "IL13RA2"), rownames(ge)))
p <- FeaturePlot(ge, features = c("HOPX", "FAM107A", "TNC", "PAX6", "VIM", "ZIC2", "SLC7A11", "MTOR", "DAB1","LAMP5", "IL13RA2"))
# ggsave("fig_gbmscte_ge_oRG_RNA.tiff", plot = p, units="in", width=size*4, height=size*3, dpi=300, compression = 'lzw')
```

```{r}
## Ventral Radial glia Progenitor cells
print(match(c("DLX1", "DLX2", "FLRT2", "LIX1"), rownames(ge)))
p <- FeaturePlot(ge, features = c("DLX1", "DLX2", "FLRT2", "LIX1"))
# ggsave("fig_gbmscte_ge_vRGprogenitor_RNA.tiff", plot = p, units="in", width=size*2, height=size*2, dpi=300, compression = 'lzw')
```

```{r}
## Cortical ventral radial glia
print(match(c("PAX6", "VIM", "ZIC2", "HOPX"), rownames(ge)))
p <- FeaturePlot(ge, features = c("PAX6", "VIM", "ZIC2", "HOPX"))
# ggsave("fig_gbmscte_ge_vRG_RNA.tiff", plot = p, units="in", width=size*2, height=size*2, dpi=300, compression = 'lzw')

```

```{r}
## IPC (Intermediate precursor cells) - early
print(match(c("NHLH1", "SLC1A3"), rownames(ge)))
p <- FeaturePlot(ge, features = c("NHLH1", "SLC1A3"))
# ggsave("fig_gbmscte_ge_IPC_early_RNA.tiff", plot = p, units="in", width=size*2, height=size, dpi=300, compression = 'lzw')
```

```{r}
## IPC (Intermediate precursor cells) - late
print(match(c("ASCL1", "NHLH2", "TP53I11", "PPP1R17", "ADRA2A", "LTBP1"), rownames(ge)))
p <- FeaturePlot(ge, features = c("ASCL1", "NHLH2", "TP53I11", "PPP1R17", "ADRA2A", "LTBP1"))
# ggsave("fig_gbmscte_ge_IPC_late_RNA.tiff", plot = p, units="in", width=size*2, height=size*6, dpi=300, compression = 'lzw')
```

```{r}
## Ventral IPC (Intermediate precursor cells)
print(match(c("FLRT2", "DLX1", "DLX2", "DLX5", "DLX6"), rownames(ge)))
p <- FeaturePlot(ge, features = c("FLRT2", "DLX1", "DLX2", "DLX5", "DLX6"))
# ggsave("fig_gbmscte_ge_ventralIPC_RNA.tiff", plot = p, units="in", width=size*2, height=size*3, dpi=300, compression = 'lzw')
```

```{r}
## dorsal IPC (Intermediate precursor cells)
print(match(c("PAX6", "ZIC2", "EOMES", "ASCL1", "SSTR2"), rownames(ge)))
p <- FeaturePlot(ge, features = c("PAX6", "ZIC2", "EOMES", "ASCL1", "SSTR2"))
# ggsave("fig_gbmscte_ge_dorsalIPC_RNA.tiff", plot = p, units="in", width=size*2, height=size*3, dpi=300, compression = 'lzw')
```

```{r}
## Endothelial Cells 
print(match(c("FLT1", "VWF", "FN1"), rownames(ge)))
p <- FeaturePlot(ge, features = c("FLT1", "VWF", "FN1"))
# ggsave("fig_gbmscte_ge_Endothelial_RNA.tiff", plot = p, units="in", width=size*2, height=size*2, dpi=300, compression = 'lzw')
```

```{r}
## T-cells 
print(match(c("CD3E", "CD8A"), rownames(ge)))
p <- FeaturePlot(ge, features = c("CD3E", "CD8A"))
# ggsave("fig_gbmscte_ge_Tcells_RNA.tiff", plot = p, units="in", width=size*2, height=size, dpi=300, compression = 'lzw')
```

```{r}
## Blood Cells 
print(match(c("HBB"), rownames(ge)))
p <- FeaturePlot(ge, features = c("HBB"))
# ggsave("fig_gbmscte_ge_Blood_RNA.tiff", plot = p, units="in", width=size, height=size, dpi=300, compression = 'lzw')
```


### Summary Dot plot

```{r}
DefaultAssay(ge) <- "RNA"
features = c("CD3E", "CD8A", #T-cells
             "FLT1", "VWF", #Endothelial
             "ASCL1", # IPC-late (?)
             "HOPX", "FAM107A", "TNC", "VIM", #orG
              "P2RY12", "PTPRC", "C1QC", "CD68", "TREM2", "GPR34", "CSF1R", #Microglia
              "GFAP", "AQP4",  "SLC1A2", "SLCO1C1", #Astrocytes
              "MBP", "MOG", #Oligodendrocytes
              "OLIG1", "OLIG2", "PDGFRA", "COL20A1", #OPC
              "GAD1", #Interneurons
              "HES1" #NPC
             )

p <- DotPlot(ge, features = features) +
      xlab("Clusters") + ylab("Known Markers") + coord_flip()
p
# ggsave("fig_gbmscte_ge_dotplot_summary.tiff", plot = p, units="in", width=size*1.4, height=size*1.1, dpi=300, compression = 'lzw')
```
```{r}
DefaultAssay(ge) <- "integrated"
features <- c(#"HBB", #Blood
              "CD3E", #"CD8A", #T-cells
              "FLT1", "VWF", "FN1", #Endothelial
              #"ASCL1", # IPC-late (?)
              #"PVALB", "SST", "GAD1", # Differentiated Cortical Interneurons (Inhibitory neurons)
              "MKI67", "MCM6", "TOP2A", "PCNA",  #Proliferating Cell Type
              "PTPRC", "C1QC", "CD68", "TREM2", "GPR34", "CSF1R", "CX3CR1", #Microglia, 
                #"P2RY12", "HEXB" were absent
              "GFAP", "AQP4", "HOPX", "SLC1A2", #Astrocytes
              "MYRF", "MBP", "MOG", "PLP1", #Oligodendrocytes
              "OLIG1", "OLIG2", "PDGFRA", "SOX10"  #OPC, "COL20A1" was absent
              #"HES1" #NPC
             )

p <- DotPlot(ge, features = features) + scale_colour_gradient2() + 
      xlab("Clusters") + ylab("Known Markers") + coord_flip()
p
# ggsave("fig_gbmscte_ge_dotplot_summary.tiff", plot = p, units="in", width=size*1.4, height=size*1.1, dpi=300, compression = 'lzw')
```

```{r}
# Dotplot for RG, oRG, and vRG
DefaultAssay(ge) <- "integrated"
features.RG <- c(#"VIM", "SOX2", "SLC1A3", "HES1", "PAX6", "GLI3", "PDGFD", #RG -- from Pollen2015, 
                 "GFAP", "VIM", "HES1", "PAX6", #RG (only those present in normalized assay)
                 "TNC", "PTPRZ1", "FAM107A", "HOPX", #oRG -- "LIFR", RPS6 not present, Pollen2015 & Nowakowski2017, respectively.
                 # "DAB1", #oRG + vRG not present Nowakowski2017
                 "CRYAB", "TAGLN2", "FBXO32", "LIX1", "ZIC2"#vRG -- PDGFD, PALLD NFATC2 were absent (Pollen2015), and "STMN2", "ELAVL4" were targeting other cell types (oligodendrocyte cluster 8) (Nowakowski2017)
                 )
p <- DotPlot(ge, features = features.RG) +   scale_colour_gradient2() + 
      xlab("Known Brain Cell Markers") + ylab("Clusters") + coord_flip()
p
# ggsave("fig_gbmscte_ge_dotplot_RG_int.tiff", plot = p, units="in", width=size*1.3, height=size*0.7, dpi=300, compression = 'lzw')
```
Repeat for other PCA resolutions

```{r}
#Dotplot for PC20r0.4
DefaultAssay(ge) <- "integrated"
print(head(ge@active.ident))
ge <- SetIdent(ge, value = ge@meta.data$integrated_snn_res.0.4) 
print(head(ge@active.ident))
features <- c(#"HBB", #Blood
              "CD3E", #"CD8A", #T-cells
              "FLT1", "VWF", "FN1", #Endothelial
              #"ASCL1", # IPC-late (?)
              #"PVALB", "SST", "GAD1", # Differentiated Cortical Interneurons (Inhibitory neurons)
              "MKI67", "MCM6", "TOP2A", "PCNA",  #Proliferating Cell Type
              "PTPRC", "C1QC", "CD68", "TREM2", "GPR34", "CSF1R", "CX3CR1", #Microglia, 
                #"P2RY12", "HEXB" were absent
              "GFAP", "AQP4", "HOPX", "SLC1A2", #Astrocytes
              "MYRF", "MBP", "MOG", "PLP1", #Oligodendrocytes
              "OLIG1", "OLIG2", "PDGFRA", "SOX10"  #OPC, "COL20A1" was absent
              #"HES1" #NPC
             )

p <- DotPlot(ge, features = features) +   scale_colour_gradient2() + 
      xlab("Known Brain Cell Markers") + ylab("Clusters") + coord_flip()
print(p)
# ggsave("fig_gbmscte_ge_PC20r04_dotplot_summary_int.tiff", plot = p, units="in", width=size*1.1, height=size*1.2, dpi=300, compression = 'lzw')

p <- UMAPPlot(ge)
print(p)
# ggsave("fig_gbmscte_ge_PC20r04_UMAP.tiff", plot = p, units="in", width=size*1.2, height=size*1, dpi=300, compression = 'lzw')
```

```{r}
# Dotplot for RG, oRG, and vRG
DefaultAssay(ge) <- "integrated"
ge <- SetIdent(ge, value = ge@meta.data$integrated_snn_res.0.4) 
features.RG <- c(#"VIM", "SOX2", "SLC1A3", "HES1", "PAX6", "GLI3", "PDGFD", #RG -- from Pollen2015, 
                 "GFAP", "VIM", "HES1", "PAX6", #RG (only those present in normalized assay)
                 "TNC", "PTPRZ1", "FAM107A", "HOPX", #oRG -- "LIFR", RPS6 not present, Pollen2015 & Nowakowski2017, respectively.
                 # "DAB1", #oRG + vRG not present Nowakowski2017
                 "CRYAB", "TAGLN2", "FBXO32", "LIX1"#vRG -- PDGFD, PALLD NFATC2 were absent (Pollen2015), and "STMN2", "ELAVL4" were targeting other cell types (oligodendrocyte cluster 8) (Nowakowski2017), ZIC2 was also absent
                 )
p <- DotPlot(ge, features = features.RG) +   scale_colour_gradient2() + 
      xlab("Known Brain Cell Markers") + ylab("Clusters") + coord_flip()
p
# ggsave("fig_gbmscte_ge_PCr04_dotplot_RG_int.tiff", plot = p, units="in", width=size*1.3, height=size*0.7, dpi=300, compression = 'lzw')
```

### Update Metadata

- isRG: {0: no, 1: yes}
- isoRG: {0:no, 1: oRG}
- isvRG: {0: no, 1: vRG}

```{r}
#Create updated metadata
DefaultAssay(ge) <- "integrated"
meta <- ge@meta.data

ge_celltype <- c(
  '0' = "Astrocyte",
  '1' = "OPC",
  '2' = "Intermediate", 
  '3' = "T-cell",
  '4' = "Proliferating",
  '5' = "Microglia",
  '6' = "Astrocyte",
  '7' = "Proliferating",
  '8' = "Diff. Oligodendrocytes",
  '9' = "Astrocyte",
  '10' = "Diff. Oligodendrocytes",
  '11' = "Endothelial"
)

ge_rg <- c(
  '0' = 1,
  '1' = 0,
  '2' = 0, 
  '3' = 0,
  '4' = 0,
  '5' = 0,
  '6' = 0,
  '7' = 1,
  '8' = 0,
  '9' = 1,
  '10' = 0,
  '11' = 0
)

ge_org <- c(
  '0' = 1,
  '1' = 0,
  '2' = 0, 
  '3' = 0,
  '4' = 0,
  '5' = 0,
  '6' = 1,
  '7' = 0,
  '8' = 0,
  '9' = 1,
  '10' = 0,
  '11' = 0
)

ge_vrg <- c(
  '0' = 1,
  '1' = 0,
  '2' = 0, 
  '3' = 0,
  '4' = 0,
  '5' = 0,
  '6' = 0,
  '7' = 0,
  '8' = 0,
  '9' = 0,
  '10' = 0, 
  '11' = 0
)

meta$int03_celltypes <- NA
meta$int03_isRG <- 0
meta$int03_isoRG <- 0
meta$int03_isvRG <- 0

for (i in 1:length(ge_rg)) {
    meta$int03_celltypes[
        which(as.character(meta$integrated_snn_res.0.3) == names(ge_celltype[i]))]  <- ge_celltype[i]
    meta$int03_isRG[
        which(as.character(meta$integrated_snn_res.0.3) == names(ge_rg[i]))]  <- ge_rg[i]
    meta$int03_isoRG[
        which(as.character(meta$integrated_snn_res.0.3) == names(ge_org[i]))]  <- ge_org[i]
    meta$int03_isvRG[
        which(as.character(meta$integrated_snn_res.0.3) == names(ge_vrg[i]))]  <- ge_vrg[i]
}
head(meta)

ge@meta.data <- meta
# saveRDS(ge, file="ge_celltypes.rds")
# write.csv(meta,"gbmsc_meta_celltypes.csv", row.names= TRUE)
```

Create UMAP

```{r}
cbPalette <- c("#E69F00", "#56B4E9", "#009E73", "#F0E442", 
               "#CC79A7", "#ff716e", "#999999", "#0072B2", 
               "#194c76", "#D55E00", "#4C4E52")
ge <- SetIdent(ge, value = ge@meta.data$int03_celltypes) 
p <- DimPlot(ge, label=TRUE, cols = cbPalette) 
p
# ggsave("fig_gbmscte_ge_PC20r03_UMAP_celltypes_labels.tiff", plot = p, units="in", width=size*1.4, height=size*1, dpi=300, compression = 'lzw')
```

Repeat Metadata for PC20r04 clusters

```{r}
#Create updated metadata
DefaultAssay(ge) <- "integrated"
meta <- ge@meta.data

ge_celltype <- c(
  '0' = "Astrocyte",
  '1' = "Intermediate",
  '2' = "OPC", 
  '3' = "Microglia",
  '4' = "Astrocyte",
  '5' = "Intermediate",
  '6' = "Proliferating",
  '7' = "T-cell",
  '8' = "Proliferating",
  '9' = "Intermediate",
  '10' = "Diff. Oligodendrocyte",
  '11' = "Intermediate",
  '12' = "OPC",
  '13' = "Intermediate",
  '14' = "Endothelial"
)

ge_rg <- c(
  '0' = 1,
  '1' = 0,
  '2' = 0, 
  '3' = 0,
  '4' = 0,
  '5' = 0,
  '6' = 0,
  '7' = 0,
  '8' = 1,
  '9' = 0,
  '10' = 0,
  '11' = 1,
  '12' = 0,
  '13' = 0,
  '14' = 0
)

ge_org <- c(
  '1' = 1,
  '2' = 0, 
  '3' = 0,
  '4' = 1,
  '5' = 0,
  '6' = 0,
  '7' = 0,
  '8' = 0,
  '9' = 0,
  '10' = 0,
  '11' = 1,
  '12' = 0,
  '13' = 0,
  '14' = 0
)

ge_vrg <- c(
  '1' = 1,
  '2' = 0, 
  '3' = 0,
  '4' = 0,
  '5' = 0,
  '6' = 0,
  '7' = 0,
  '8' = 0,
  '9' = 0,
  '10' = 0,
  '11' = 0,
  '12' = 0,
  '13' = 0,
  '14' = 0
)

meta$int04_celltypes <- NA
meta$int04_isRG <- 0
meta$int04_isoRG <- 0
meta$int04_isvRG <- 0

for (i in 1:length(ge_rg)) {
    meta$int04_celltypes[
        which(as.character(meta$integrated_snn_res.0.4) == names(ge_celltype[i]))]  <- ge_celltype[i]
    meta$int04_isRG[
        which(as.character(meta$integrated_snn_res.0.4) == names(ge_rg[i]))]  <- ge_rg[i]
    meta$int04_isoRG[
        which(as.character(meta$integrated_snn_res.0.4) == names(ge_org[i]))]  <- ge_org[i]
    meta$int04_isvRG[
        which(as.character(meta$integrated_snn_res.0.4) == names(ge_vrg[i]))]  <- ge_vrg[i]
}
head(meta)

ge@meta.data <- meta
# saveRDS(ge, file="ge_celltypes.rds")
# write.csv(meta,"gbmsc_meta_celltypes.csv", row.names= TRUE)
```

Create UMAP

```{r}
cbPalette <- c("#E69F00", "#56B4E9", "#009E73", "#F0E442", 
               "#CC79A7", "#ff716e", "#0072B2", "#999999", 
               "#194c76", "#D55E00", "#4C4E52")
ge <- SetIdent(ge, value = ge@meta.data$int04_celltypes) 
p <- DimPlot(ge, label=TRUE, cols = cbPalette) 
p
# ggsave("fig_gbmscte_ge_PC20r04_UMAP_celltypes_labels.tiff", plot = p, units="in", width=size*1.4, height=size*1, dpi=300, compression = 'lzw')
```

### Dot Plot Summarizing known markers by cell type

```{r}
DefaultAssay(ge) <- "integrated"
ge@meta.data$int04_celltypes <- factor(ge@meta.data$int04_celltypes, 
                                       levels = c(
                                         "Astrocyte", 
                                         "OPC",
                                         "Diff. Oligodendrocyte",
                                         "Microglia",
                                         "Proliferating",
                                         "Endothelial",
                                         "T-cell",
                                         "Intermediate"
                                       ))
ge <- SetIdent(ge, value = ge@meta.data$int04_celltypes) 
features <- c(#"HBB", #Blood
              "CD3E", #"CD8A", #T-cells
              "FLT1", "VWF", "FN1", #Endothelial
              #"ASCL1", # IPC-late (?)
              #"PVALB", "SST", "GAD1", # Differentiated Cortical Interneurons (Inhibitory neurons)
              "MKI67", "MCM6", "TOP2A", "PCNA",  #Proliferating Cell Type
              "PTPRC", "C1QC", "CD68", "TREM2", "GPR34", "CSF1R", "CX3CR1", #Microglia, 
                #"P2RY12", "HEXB" were absent
              "MYRF", "MBP", "MOG", "PLP1", #Oligodendrocytes
              "OLIG1", "OLIG2", "PDGFRA", "SOX10",  #OPC, "COL20A1" was absent
              "GFAP", "AQP4", "HOPX", "SLC1A2" #Astrocytes
              #"HES1" #NPC
             )

p <- DotPlot(ge, features = features) +   scale_colour_gradient2() + 
      xlab("Known Brain Cell Markers") + ylab("Cell Types") + coord_flip() + 
      theme(axis.text.x = element_text(angle = 40, vjust = 1, hjust=1))
p
# ggsave("fig_gbmscte_ge_dotplot_summary_int_celltypes.tiff", plot = p, units="in", width=size*1.1, height=size*1.3, dpi=300, compression = 'lzw')
```


### Unload data

```{r}
rm(ge)
gc()
```


## Session Info

```{r}
sessionInfo()
```


