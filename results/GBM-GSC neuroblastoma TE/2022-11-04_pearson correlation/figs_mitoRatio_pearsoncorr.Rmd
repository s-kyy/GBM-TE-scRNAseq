---
title: 'Pearson Correlation: Mitochondrial Ratio vs TE Ratio'
output:
  pdf_document:
    toc: yes
  html_document:
    toc: yes
editor_options:
  chunk_output_type: inline
---

**Goal:** Compare mitochondrial Ratio and TE-expression in each cluster. 

## Load Libraries & Data

```{r, cache=FALSE}
library(ggplot2)
library(ggpubr)
library(SeuratObject)
library(dplyr)

library(conflicted)
conflict_prefer("select", "dplyr") ## required in %>% dplyr

set.seed(100)

gte <- readRDS("D:\\backup files\\2021-11-11\\Cluster\\scratch\\gete-gbm\\results\\GBM-GSC neuroblastoma TE\\2021-09-02\\gte_gbmscIntUmap-subtypes.rds")
# ge <- readRDS("D:\\backup files\\2021-11-11\\Cluster\\scratch\\gete-gbm\\results\\GBM-GSC neuroblastoma TE\\2021-09-02\\gte_gbmscIntUmap-subtypes.rds")


cbPalette <- c("#E69F00", "#56B4E9", "#009E73", "#F0E442", "#CC79A7", "#ff716e", "#999999", "#0072B2", "#194c76", "#D55E00")
# Ref for colorblind color palette: http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/
# with grey and black and analogous magenta 

setwd("D:\\backup files\\getegbm\\gete-gbm\\results\\GBM-GSC neuroblastoma TE\\2022-11-04_pearson correlation")
```

Compute Pearson Correlation between variables: mitochondrial expression ratio and TE expression ratio for each cluster.

```{r}
colnames(gte@meta.data)
```

```{r}
meta <- gte@meta.data[,c("integrated_snn_res.0.3", "mitoRatio", "teRatio")]
meta$mitoRatio <- meta$mitoRatio*100 
meta <- meta %>% tibble::rownames_to_column("cells")

meta <- meta %>%
  group_by(integrated_snn_res.0.3) %>%
  dplyr::mutate(PearsonCorr = cor(mitoRatio, teRatio, method = "pearson")) %>%
  dplyr::mutate(pval = cor.test(mitoRatio, teRatio, method = "pearson",)$p.value)

write.csv(meta, "gte_pearsoncorr.csv", row.names=FALSE)
```

Overall Correlation across entire dataset:

```{r}
cor.test(meta$mitoRatio, meta$teRatio)
```

Resulting Correlation Coefficient is slightly negatively correlated (Pearson Correlation = -0.0947877, p.val = 1.720902e-99 therefore < 2.2e-16)

## Scatter Plots

MitoRatio % versus teRatio %

```{r, cache=FALSE, out.width = "100%"}
dev.new()
p <- meta %>% ggscatter(x = "mitoRatio", y = "teRatio", 
    add = "reg.line", conf.int = TRUE, 
    add.params = list(color="dodgerblue"), # regression line color
    cor.coef = TRUE, cor.method = "pearson",
    size = 0.7,
    color="grey70", fill = "grey70",
    facet.by = "integrated_snn_res.0.3", 
    xlab="Mitochondrial Ratio (%)", ylab="Retrotransposon expression Ratio (%)")
    # facet_wrap(meta$integrated_snn_res.0.3, nrow = 3)
    
p
size = 8
ggsave("fig_gbmscte_gte_scatter_pearsoncorr.tiff", units="in", width=size*1.2, height=size, dpi=300, compression = 'lzw')
```


## SessionInfo

```{r}
sessionInfo()
```

